<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>PongBreak - Tyler Wood</title>




<meta name="description" content="A networked mashup of Pong and Breakout.">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Tyler Wood">
<meta property="og:title" content="PongBreak">


  <link rel="canonical" href="http://localhost:4000/work/88_pongbreak/">
  <meta property="og:url" content="http://localhost:4000/work/88_pongbreak/">



  <meta property="og:description" content="A networked mashup of Pong and Breakout.">



  <meta name="twitter:site" content="@tyskwo">
  <meta name="twitter:title" content="PongBreak">
  <meta name="twitter:description" content="A networked mashup of Pong and Breakout.">
  <meta name="twitter:url" content="http://localhost:4000/work/88_pongbreak/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/portfolio/2015/pongbreak/feature.png">
  

  





  <meta property="og:image" content="http://localhost:4000/assets/images/portfolio/2015/pongbreak/feature.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-03-05T16:53:44-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tyler Wood",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/tyskwo","https://github.com/tyskwo","https://www.linkedin.com/in/tyskwo"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tyler Wood Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#707070">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300i,400,400i,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i" rel="stylesheet">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/"><p class="masthead__menu-item masthead__menu-item--lgl">TYLER</p>WOOD</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/blog">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/resume">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/work">All Work</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    
  







<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/assets/images/portfolio/2015/pongbreak/feature.png" alt="PongBreak" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
        
        <h2 id="2015-c">2015, C++</h2>

      
    
      
      
        <h3>Description</h3>
        <p>A networked mashup of Pong and Breakout. Uses RakNet and SFML.</p>

      
    
      
      
        <h3>Outcomes</h3>
        <p>CMake.</p>

<p>RakNet.</p>

<p>TCP/UDP.</p>

<p>Client/Server model.</p>

      
    
      
      
        <h3>Links</h3>
        
      
    
      
      
        <p><a href="https://github.com/tyskwo/RakNet_PongBreak" class="btn btn--large"><i class="fa fa-github" aria-hidden="true"></i> Repository</a></p>
      
    
      
      
        <p><a href="/assets/downloads/2015/pongbreak/PongBreak.zip" class="btn btn--large"><i class="fa fa-download" aria-hidden="true"></i> Executable</a></p>
      
    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">PongBreak
</h1>
          <!--<p class="page__meta">2015, C++</p>
          -->
        </header>
      

      <section class="page__content" itemprop="text">
        <p>This project was an exercise in networking for games: using RakNet, there is a dedicated server that clients can connect to. Concepts like packet loss, differences between TCP/UDP, and different ways to handle network lag and syncing was covered over the course of the project.</p>

<h3 id="architecture">Architecture</h3>

<p><em>PongBreak</em> uses an authoritative server which simulates the game and sends the states to its clients to display to the players. This rids the need of temporal delay. However, there is interpolation to account for the time difference between the clients and the server.</p>

<p><img src="http://localhost:4000/assets/images/portfolio/2015/pongbreak/intro.gif" alt="pongbreak-intro" class="align-center" /></p>

<h5 id="server">Server</h5>

<p>The server contains a 2D array of client pairs, giving it the capability of running multiple games at the same time. It has an update loop, where it updates each game individually, and sends the new game state (a struct called <code class="highlighter-rouge">GameInfo</code>) to each client. Upon initialization, it creates all of the <code class="highlighter-rouge">Game</code> objects, as well as opens up connection ports to listen on. Upon a game ending, it waits for confirmation from a client to restart, or closes the connections and frees up the client slots if the clients disconnect.</p>

<p>The clients and server send packets back and forth a couple times each second. In order to reduce the amount of information flowing over the network, the info stored in each packet is as concise as possible, saving space. Here’s the method that reads the packets’ information:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">Server</span><span class="o">::</span><span class="n">getPackets</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">mpServer</span><span class="o">-&gt;</span><span class="n">Receive</span><span class="p">();</span> <span class="n">p</span><span class="p">;</span> <span class="n">mpServer</span><span class="o">-&gt;</span><span class="n">DeallocatePacket</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mpServer</span><span class="o">-&gt;</span><span class="n">Receive</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="n">packetIdentifier</span> <span class="o">=</span> <span class="n">GetPacketIdentifier</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

        <span class="c1">//obviously all of these cases are filled out with the correct logic
</span>		<span class="k">switch</span> <span class="p">(</span><span class="n">packetIdentifier</span><span class="p">)</span>
		<span class="p">{</span>
		<span class="k">case</span> <span class="n">ID_DISCONNECTION_NOTIFICATION</span>

		<span class="k">case</span> <span class="n">ID_INCOMPATIBLE_PROTOCOL_VERSION</span>

		<span class="k">case</span> <span class="n">ID_CONNECTED_PING</span>
		<span class="k">case</span> <span class="n">ID_UNCONNECTED_PING</span>

		<span class="k">case</span> <span class="n">ID_CONNECTION_LOST</span>

		<span class="k">case</span> <span class="n">ID_NEW_INCOMING_CONNECTION</span>

		<span class="k">case</span> <span class="n">ID_SEND_PADDLE_DATA</span>

		<span class="k">case</span> <span class="n">ID_START_GAME</span>

		<span class="nl">default:</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span><span class="err">;</span>
			<span class="k">break</span><span class="err">;</span>
		<span class="err">}</span>
	<span class="err">}</span>
<span class="err">}</span></code></pre></figure>

<p>The magic lies in <code class="highlighter-rouge">GetPacketIdentifier</code>, which gets the header of the packet. This allows us to understand what type of packet it is (and what we should do with its contents). For us, the packet identifiers are a simple enum.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Server</span><span class="o">::</span><span class="n">GetPacketIdentifier</span><span class="p">(</span><span class="n">RakNet</span><span class="o">::</span><span class="n">Packet</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">255</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ID_TIMESTAMP</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RakAssert</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RakNet</span><span class="o">::</span><span class="n">MessageID</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RakNet</span><span class="o">::</span><span class="n">Time</span><span class="p">));</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">RakNet</span><span class="o">::</span><span class="n">MessageID</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RakNet</span><span class="o">::</span><span class="n">Time</span><span class="p">)];</span>
	<span class="p">}</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span></code></pre></figure>

<p>After <code class="highlighter-rouge">update()</code> is finished, it sends the game info to all of the clients, simply sending a packet to each client:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">Server</span><span class="o">::</span><span class="n">broadcastGameInfo</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mClientPairs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">GameInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">mGameInfos</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
		<span class="n">info</span><span class="p">.</span><span class="n">mID</span> <span class="o">=</span> <span class="n">ID_RECIEVE_GAME_INFO</span><span class="p">;</span>

		<span class="n">mpServer</span><span class="o">-&gt;</span><span class="n">Send</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="n">HIGH_PRIORITY</span><span class="p">,</span> <span class="n">RELIABLE_ORDERED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mGuidPairs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">false</span><span class="p">);</span>
		<span class="n">mpServer</span><span class="o">-&gt;</span><span class="n">Send</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="n">HIGH_PRIORITY</span><span class="p">,</span> <span class="n">RELIABLE_ORDERED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mGuidPairs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">false</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span> <span class="c1">//we send the same GameInfo to each set of clients
</span>	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h5 id="client">Client</h5>

<p>The client simply responds to user input, and draws the updated <code class="highlighter-rouge">GameInfo</code> sent from the server. Upon receiving input from the player, it converts that to data based on the most recent info. For instance, here’s how a client would send updated paddle info:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">Keyboard</span><span class="o">::</span><span class="n">isKeyPressed</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">Keyboard</span><span class="o">::</span><span class="n">Up</span><span class="p">))</span>
<span class="p">{</span>
	<span class="n">mpClient</span><span class="o">-&gt;</span><span class="n">setPaddlePosition</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.....</span>


<span class="k">if</span> <span class="p">(</span><span class="n">mpTimer</span><span class="o">-&gt;</span><span class="n">shouldUpdate</span><span class="p">())</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">isFirstConnected</span><span class="p">())</span>
        <span class="n">sendPaddleData</span><span class="p">(</span><span class="n">mGameInfo</span><span class="p">.</span><span class="n">lPlayer</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mGameInfo</span><span class="p">.</span><span class="n">lPlayer</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">sendPaddleData</span><span class="p">(</span><span class="n">mGameInfo</span><span class="p">.</span><span class="n">rPlayer</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mGameInfo</span><span class="p">.</span><span class="n">rPlayer</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.....</span>

<span class="kt">void</span> <span class="n">Client</span><span class="o">::</span><span class="n">sendPaddleData</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Position</span> <span class="n">pos</span><span class="p">;</span>
	<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
	<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
	<span class="n">pos</span><span class="p">.</span><span class="n">mID</span> <span class="o">=</span> <span class="n">ID_SEND_PADDLE_DATA</span><span class="p">;</span>
	<span class="n">mpClient</span><span class="o">-&gt;</span><span class="n">Send</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pos</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="n">HIGH_PRIORITY</span><span class="p">,</span> <span class="n">RELIABLE_ORDERED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RakNet</span><span class="o">::</span><span class="n">UNASSIGNED_SYSTEM_ADDRESS</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h3 id="retrospection-and-postmortem">Retrospection and Postmortem</h3>

<p>This was my first experience in networking, and I am thankful that it was using an industry standard like <em>RakNet</em>. It gave me experience in separating server logic from game logic, as well as introduce me to topics like interpolation, replication, and ways to handle network lag like temporal delay. The game itself is simple, but it does a good job in creating an environment where a good amount of data is needed to be sent back and forth.</p>

        
      </section>

      
      <footer class="page__meta">
        
        


      </footer>
      
  <nav class="pagination">
    
      <a href="http://localhost:4000/work/87_earth-scape/" class="pagination--pager" title="Earth-scape
">Previous</a>
    
    
      <a href="http://localhost:4000/work/89_obstacle-avoidance/" class="pagination--pager" title="Obstacle Avoidance
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Connect:</strong></li>
    
    
      <li><a href="https://twitter.com/tyskwo"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/tyskwo"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Tyler Wood.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92078969-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>

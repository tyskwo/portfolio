<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Flocking - Tyler Wood</title>




<meta name="description" content="Sheep in a field, fish in the ocean. People in a crowd?">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Tyler Wood">
<meta property="og:title" content="Flocking">


  <link rel="canonical" href="http://localhost:4000/work/92_flocking/">
  <meta property="og:url" content="http://localhost:4000/work/92_flocking/">



  <meta property="og:description" content="Sheep in a field, fish in the ocean. People in a crowd?">



  <meta name="twitter:site" content="@tyskwo">
  <meta name="twitter:title" content="Flocking">
  <meta name="twitter:description" content="Sheep in a field, fish in the ocean. People in a crowd?">
  <meta name="twitter:url" content="http://localhost:4000/work/92_flocking/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/portfolio/2015/flocking/feature.png">
  

  





  <meta property="og:image" content="http://localhost:4000/assets/images/portfolio/2015/flocking/feature.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-03-05T00:45:06-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tyler Wood",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/tyskwo","https://github.com/tyskwo","https://www.linkedin.com/in/tyskwo"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tyler Wood Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#707070">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300i,400,400i,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i" rel="stylesheet">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/"><p class="masthead__menu-item masthead__menu-item--lgl">TYLER</p>WOOD</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/blog">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/resume">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/work">All Work</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    
  







<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/assets/images/portfolio/2015/flocking/feature.png" alt="Flocking" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
        
        <h2 id="2015-c">2015, C++</h2>

      
    
      
      
        <h3>Description</h3>
        <p>Sheep in a field, fish in the ocean. People in a crowd? The classic AI steering algorithm.</p>

      
    
      
      
        <h3>Outcomes</h3>
        <p>Flocking.</p>

<p>Allegro5.</p>

<p>Using a third-party framework.</p>

      
    
      
      
        <h3>Links</h3>
        
      
    
      
      
        <p><a href="/assets/downloads/portfolio/2015/flocking/flocking.zip" class="btn btn--large"><i class="fa fa-download" aria-hidden="true"></i> Executable</a></p>
      
    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Flocking
</h1>
          <!--<p class="page__meta">2015, C++</p>
          -->
        </header>
      

      <section class="page__content" itemprop="text">
        <p>This is my implementation of Craig Reynold’s famous <a href="https://en.wikipedia.org/wiki/Flocking_(behavior)">flocking algorithm.</a></p>

<h3 id="the-setup">The Setup</h3>

<p>The demo has a base boid class, which has a linear and rotational velocity, an acceleration, and maxes for all associated values. Each boid also has a steering object, which can be any available steering in the program, and in this case, is the flocking steering, which has three sub-steerings: alignment, cohesion, and separation.</p>

<figure class="align-center">
  


<!-- Courtesy of embedresponsively.com //-->
<div class="responsive-video-container">

  <iframe src="http://player.vimeo.com/video/151457337" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

</div>

  <figcaption>Note: Running Quicktime on OS X, recording Windows 7 through VMWare is not optimal. The project runs cleanly at 60fps when my Macbook isn't dying with Quicktime recording.</figcaption>
</figure>

<h3 id="the-algorithm">The Algorithm</h3>
<p>The behavior behind the steering algorithm is really cool:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">Steering</span><span class="o">*</span> <span class="n">FlockingSteering</span><span class="o">::</span><span class="n">getSteering</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Vector2D</span> <span class="n">align</span> <span class="o">=</span>
            <span class="n">mpAlignment</span><span class="o">-&gt;</span><span class="n">getSteering</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getLinear</span><span class="p">()</span>
          <span class="o">*</span> <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getAlignmentWeight</span><span class="p">();</span>
	<span class="n">Vector2D</span> <span class="n">cohesion</span> <span class="o">=</span>
            <span class="n">mpCohesion</span><span class="o">-&gt;</span><span class="n">getSteering</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getLinear</span><span class="p">()</span>
          <span class="o">*</span> <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getCohesionWeight</span><span class="p">();</span>
	<span class="n">Vector2D</span> <span class="n">separation</span> <span class="o">=</span>
            <span class="n">mpSeparation</span><span class="o">-&gt;</span><span class="n">getSteering</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getLinear</span><span class="p">()</span>
          <span class="o">*</span> <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getSeparationWeight</span><span class="p">();</span>
	<span class="n">Vector2D</span> <span class="n">combined</span><span class="p">;</span>

	<span class="n">combined</span> <span class="o">+=</span> <span class="n">align</span> <span class="o">+</span> <span class="n">combined</span> <span class="o">+</span> <span class="n">separation</span><span class="p">;</span>

	<span class="n">combined</span> <span class="o">/=</span>
           <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getAlignmentWeight</span><span class="p">()</span>
         <span class="o">+</span> <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getCohesionWeight</span><span class="p">()</span>
         <span class="o">+</span> <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getSeparationWeight</span><span class="p">();</span>

	<span class="n">combined</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
	<span class="n">combined</span> <span class="o">*=</span> <span class="n">mpMover</span><span class="o">-&gt;</span><span class="n">getMaxAcceleration</span><span class="p">();</span>
	<span class="n">mLinear</span> <span class="o">=</span> <span class="n">combined</span><span class="p">;</span>

	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>This function calls each of the three sub-steering algorithms: alignment to the group, cohesion to the group, and separation from the group, and then combines the returned linear velocity vectors. Using this combined vector, we divide it by the total weight and normalize it, and then multiple it by the maxAcceleration to keep the velocity constant.</p>

<p>The sub-steerings are also super simple. For instance, here’s the Alignment steering:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">Steering</span><span class="o">*</span> <span class="n">GroupAlignmentSteering</span><span class="o">::</span><span class="n">getSteering</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">mpNeighbors</span> <span class="o">=</span>
       <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getUnitManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getNeighbors</span><span class="p">(</span>
           <span class="n">mpMover</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(),</span>
           <span class="n">gpGame</span><span class="o">-&gt;</span><span class="n">getFileManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getAlignmentRadius</span><span class="p">());</span>

    <span class="n">Vector2D</span> <span class="n">linearVector</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">mpNeighbors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
	    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mpNeighbors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span> <span class="n">linearVector</span> <span class="o">+=</span> <span class="n">mpNeighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">getVelocity</span><span class="p">();</span> <span class="p">}</span>

	    <span class="n">linearVector</span> <span class="o">/=</span> <span class="n">mpNeighbors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
	    <span class="n">linearVector</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>

	    <span class="n">mLinear</span> <span class="o">=</span> <span class="n">linearVector</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>For each of the sub-steerings, we find all the other boids within the given radius, mpNeighbors. As long as there are some neighbors, we find their average velocity, normalize the resulting vector, and set it equal to our velocity. Like I said, super simple stuff.</p>

<h3 id="retrospection-and-postmortem">Retrospection and Postmortem</h3>
<p>This project was at the tail end of my steering algorithms section. By this point, I have a good handle on steering algorithms, from avoidance, follow, and wander, to more advanced like this and other weighted algorithms. In fact, DASHockey uses multiple steering algorithms in a weighted fashion for the opponent AI. This also was a good exercise in optimization – I can get up to 300 boids on my machine before the frame rate starts to suffer, and I believe it is an issue with how I call Allegro5’s draw functions, not the AI behavior.</p>

        
      </section>

      
      <footer class="page__meta">
        
        


      </footer>
      
  <nav class="pagination">
    
      <a href="http://localhost:4000/work/91_flow-field-pathfinding/" class="pagination--pager" title="Flow Field Pathfinding
">Previous</a>
    
    
      <a href="http://localhost:4000/work/93_shmup/" class="pagination--pager" title="SHMUP
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Connect:</strong></li>
    
    
      <li><a href="https://twitter.com/tyskwo"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/tyskwo"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Tyler Wood.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92078969-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>

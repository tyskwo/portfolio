<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Obstacle Avoidance - Tyler Wood</title>




<meta name="description" content="A ‘feeling’ way to avoid things.">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Tyler Wood">
<meta property="og:title" content="Obstacle Avoidance">


  <link rel="canonical" href="http://localhost:4000/work/89_obstacle-avoidance/">
  <meta property="og:url" content="http://localhost:4000/work/89_obstacle-avoidance/">



  <meta property="og:description" content="A ‘feeling’ way to avoid things.">



  <meta name="twitter:site" content="@tyskwo">
  <meta name="twitter:title" content="Obstacle Avoidance">
  <meta name="twitter:description" content="A ‘feeling’ way to avoid things.">
  <meta name="twitter:url" content="http://localhost:4000/work/89_obstacle-avoidance/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/portfolio/2015/obstacle-avoidance/feature.png">
  

  





  <meta property="og:image" content="http://localhost:4000/assets/images/portfolio/2015/obstacle-avoidance/feature.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-02-26T12:56:12-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tyler Wood",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/tyskwo","https://github.com/tyskwo","https://www.linkedin.com/in/tyskwo"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tyler Wood Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#707070">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300i,400,400i,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i" rel="stylesheet">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/"><p class="masthead__menu-item masthead__menu-item--lgl">TYLER</p>WOOD</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/blog">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/resume">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/work">All Work</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    
  







<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/assets/images/portfolio/2015/obstacle-avoidance/feature.png" alt="Obstacle Avoidance" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
        
        <h2 id="2016-swift">2016, Swift</h2>

      
    
      
      
        <h3>Description</h3>
        <p>A tech demo where ‘boids’ avoid obstacles by using a set of ‘feelers’ to see their immediate surroundings.</p>

      
    
      
      
        <h3>Outcomes</h3>
        <p>Swift: optionals, guards, etc.</p>

<p>SpriteKit.</p>

<p>Object pooling.</p>

<p>Protocol-oriented programming.</p>

      
    
      
      
        <h3>Links</h3>
        
      
    
      
      
        <p><a href="/assets/downloads/2015/obstacle-avoidance/ObstacleAvoidance.app" class="btn btn--large"><i class="fa fa-download" aria-hidden="true"></i> Executable</a></p>
      
    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Obstacle Avoidance
</h1>
          <!--<p class="page__meta">2015, Swift</p>
          -->
        </header>
      

      <section class="page__content" itemprop="text">
        <p><img src="http://localhost:4000/assets/images/portfolio/2015/obstacle-avoidance/intro.gif" alt="raycast-intro" class="align-center" /></p>

<p>This project was an exercise in two parts: in AI-based obstacle avoidance, and in using SpriteKit best practices. The demo has three modes to explore different uses of raycast obstacle avoidance: a generic common approach, a reversed ‘follow/block’ approach, and a ‘field condition’ approach.</p>

<h3 id="the-rays">The Rays</h3>

<p>Each ray is a CGPath, which is then added to an SKSpriteNode. Each node has a physics body which has its contact bit designator set to detect contact with rocks, but not have a solid body attached to it. This SKSpriteNode is then added to the parent node (the shape), which has its own physics body which is what forces act upon. This allows the rays to be feelers of sorts.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">//triangle initialization</span>
<span class="nf">init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="kt">Triangle</span><span class="p">)</span>

    <span class="c1">//add the rays</span>
    <span class="n">rays</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Feeler</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="kt">AngleDependent</span><span class="p">))</span>
    <span class="n">rays</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Feeler</span><span class="p">(</span><span class="nv">collideImpulse</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">.</span><span class="kt">Impulse</span><span class="o">.</span><span class="kt">Down</span><span class="p">))</span>
    <span class="n">rays</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Feeler</span><span class="p">(</span><span class="nv">collideImpulse</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">.</span><span class="kt">Impulse</span><span class="o">.</span><span class="kt">Up</span><span class="p">))</span>

    <span class="c1">//set the rotation</span>
    <span class="n">rays</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">zRotation</span> <span class="o">=</span>  <span class="kt">Logic</span><span class="o">.</span><span class="kt">Boid</span><span class="o">.</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="mf">3.14</span>
    <span class="n">rays</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">zRotation</span> <span class="o">=</span> <span class="o">-</span><span class="kt">Logic</span><span class="o">.</span><span class="kt">Boid</span><span class="o">.</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="mf">3.14</span>

    <span class="c1">//attach the rays to self</span>
    <span class="k">for</span> <span class="n">ray</span> <span class="k">in</span> <span class="n">rays</span>
    <span class="p">{</span>
        <span class="n">ray</span><span class="o">.</span><span class="n">zPosition</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">zPosition</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">ray</span><span class="o">.</span><span class="nf">attachTo</span><span class="p">(</span><span class="nv">parent</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The demo also has a debug mode (by pressing ‘D’ on a QWERTY keyboard), which shows the values for the amount of rocks (when applicable), angle of the rays, force during ray contact, simulation speed, and length of the rays. The length is updated on newly spawned shapes. The rays turn red during contact with a rock to show their logic. In the above code snippet, you see <code class="highlighter-rouge">Logic.Boid.angle</code>: all of the data for the boid types is saved and loaded from a plist file:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="cm">/** Save the current parameters as the new defaults */</span>
<span class="kd">func</span> <span class="nf">saveDefaults</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//get the plist file</span>
    <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">NSBundle</span><span class="o">.</span><span class="nf">mainBundle</span><span class="p">()</span><span class="o">.</span><span class="nf">pathForResource</span><span class="p">(</span><span class="s">"BoidParams"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"plist"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">plist</span> <span class="o">=</span> <span class="kt">NSMutableDictionary</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSMutableDictionary</span>

    <span class="k">switch</span> <span class="n">currentMode</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">triangle</span><span class="p">:</span>
        <span class="k">let</span> <span class="nv">triangleDictionary</span> <span class="o">=</span> <span class="n">plist</span><span class="o">.</span><span class="nf">objectForKey</span><span class="p">(</span><span class="s">"Triangle"</span><span class="p">)</span><span class="o">!</span>

        <span class="n">triangleDictionary</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="kt">Logic</span><span class="o">.</span><span class="kt">Boid</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span>         <span class="nv">forKey</span><span class="p">:</span> <span class="s">"angle"</span> <span class="p">)</span>
        <span class="n">triangleDictionary</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="kt">Logic</span><span class="o">.</span><span class="kt">Boid</span><span class="o">.</span><span class="n">impulseAmount</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"force"</span> <span class="p">)</span>
        <span class="n">triangleDictionary</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="kt">Logic</span><span class="o">.</span><span class="kt">Boid</span><span class="o">.</span><span class="n">rayLength</span><span class="p">,</span>     <span class="nv">forKey</span><span class="p">:</span> <span class="s">"length"</span><span class="p">)</span>

        <span class="n">plist</span><span class="o">.</span><span class="nf">writeToFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>

    <span class="k">default</span><span class="p">:</span> <span class="kd">func</span> <span class="nf">doNothing</span><span class="p">()</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p><img src="http://localhost:4000/assets/images/portfolio/2015/obstacle-avoidance/debug.gif" alt="raycast-debug" class="align-center" /></p>

<h3 id="the-modes">The Modes</h3>

<figure class="half">
    <img src="/assets/images/portfolio/2015/obstacle-avoidance/mode2.gif" />
    <img src="/assets/images/portfolio/2015/obstacle-avoidance/mode3.gif" />
</figure>
<p>As stated earlier, there are three modes in the demo, to explore different applications of this. Most (video game) uses are for enemy AI avoiding obstacles (hence the obvious name), but I wanted to see if there were other possible applications throughout games. The first is a generic three-ray approach that simply the avoids the incoming rocks. The second mode, using the same logic as the other two, tries to stay behind the randomly moving rock. This could act as a following or blocking behavior, depending on the perceived direction of travel.</p>

<p>This could be useful in racing games when the player tries to overtake opponents, like in many arcade racing games, or for NPCs to follow the payer. The third mode serves two purposes, really. Firstly, it is an upgraded first mode, with five rays as opposed to three, which shows how much more successful two extra rays can be. The third extra ray, the circle around it, acts as a ‘field’ (not the physics type), which in this case causes the shape to shrink in a last-ditch effort to avoid getting hit. This could be used in other ways, like a crude distance-based AI state machine with multiple rings.</p>

<h3 id="retrospection-and-postmortem">Retrospection and Postmortem</h3>

<p>Being my first full project in Swift, the code isn’t the neatest, and given the time frame for the project, the concepts might not be fully-realized, but this is a good representation of what the technique is capable of. Furthermore, this project is what I submitted for a 2016 WWDC scholarship – <a href="https://twitter.com/tyskwo/status/729832151320035328">which I am proud to say I was awarded.</a> I hope to one day go back and explore raycasting some more – there are a ton more applications floating around in my head, maybe a few of them will be successful in application. Also, post-completion, I found a memory leak associated with SKShapeNode allocation – <a href="http://stackoverflow.com/questions/27883162/does-skshapenode-still-leak-memory">this seems</a> <a href="http://stackoverflow.com/questions/18889297/skshapenode-has-unbounded-memory-growth">to be</a> <a href="http://sartak.org/2014/03/skshapenode-you-are-dead-to-me.html">reported elsewhere,</a> and hopefully Apple fixes it at WWDC this year.</p>

        
      </section>

      
      <footer class="page__meta">
        
        


      </footer>
      
  <nav class="pagination">
    
      <a href="http://localhost:4000/work/88_pongbreak/" class="pagination--pager" title="PongBreak
">Previous</a>
    
    
      <a href="http://localhost:4000/work/90_shooter-state-machine/" class="pagination--pager" title="Shooter State Machine
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Connect:</strong></li>
    
    
      <li><a href="https://twitter.com/tyskwo"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/tyskwo"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Tyler Wood.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92078969-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>

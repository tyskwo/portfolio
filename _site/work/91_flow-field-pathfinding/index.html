<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Flow Field Pathfinding - Tyler Wood</title>




<meta name="description" content="Like water down a tube.">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Tyler Wood">
<meta property="og:title" content="Flow Field Pathfinding">


  <link rel="canonical" href="http://localhost:4000/work/91_flow-field-pathfinding/">
  <meta property="og:url" content="http://localhost:4000/work/91_flow-field-pathfinding/">



  <meta property="og:description" content="Like water down a tube.">



  <meta name="twitter:site" content="@tyskwo">
  <meta name="twitter:title" content="Flow Field Pathfinding">
  <meta name="twitter:description" content="Like water down a tube.">
  <meta name="twitter:url" content="http://localhost:4000/work/91_flow-field-pathfinding/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/portfolio/2015/flow-field-pathfinding/feature.png">
  

  





  <meta property="og:image" content="http://localhost:4000/assets/images/portfolio/2015/flow-field-pathfinding/feature.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-03-05T00:45:06-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tyler Wood",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/tyskwo","https://github.com/tyskwo","https://www.linkedin.com/in/tyskwo"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tyler Wood Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/images/favicons/manifest.json">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#707070">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300i,400,400i,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i" rel="stylesheet">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/"><p class="masthead__menu-item masthead__menu-item--lgl">TYLER</p>WOOD</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/blog">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/resume">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/work">All Work</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    
  







<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/assets/images/portfolio/2015/flow-field-pathfinding/feature.png" alt="Flow Field Pathfinding" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
        
        <h2 id="2015-c">2015, C++</h2>

      
    
      
      
        <h3>Description</h3>
        <p>A tech demo where ‘boids’ get their movement direction based on the tile they currently are over.</p>

      
    
      
      
        <h3>Outcomes</h3>
        <p>Flow field.</p>

<p><code class="highlighter-rouge">std::map</code></p>

      
    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Flow Field Pathfinding
</h1>
          <!--<p class="page__meta">2015, C++</p>
          -->
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Flow fields are a form of pathfinding and are useful when handling many objects at once – like crowds, or hordes of enemies – because the paths are calculated all at once. In fact, all possible paths are calculated at once, using the terrain to calculate cost of movement. This project uses a tile-based approach to flow fields, and includes multiple types of terrain as well as an editor to test the functionality.</p>

<p><img src="http://localhost:4000/assets/images/portfolio/2015/flow-field-pathfinding/example.gif" alt="flow-field-intro" class="align-center" /></p>

<h3 id="the-field">The Field</h3>

<p>The flow field consists of three steps: creating a cost field based on the terrain, generating an integration field from the cost field based on the distance from the goal tile, and then creating the actual flow field using the values from the integration field.</p>

<p>The cost field is created by looking at the terrain at each tile. For instance, mountains would have a much higher cost value than a field, and water might be considered impassable depending on the game, giving it a humongous cost. These values are hard-coded into the game some how and are attached to each terrain.</p>

<p>The integration field is then calculated by using the cost of each tile, and adding to that the direct distance to the goal tile.</p>

<p>The integration field is where most of the work in the flow field calculation is done. In order to create the integration field we will use a modified version of Dijkstra’s algorithm.</p>

<p>This is a list of the steps that the algorithm takes to calculate the field:</p>

<ul>
  <li><em>The algorithm starts by resetting the value of all cells to the max cost.</em></li>
  <li><em>The goal node then gets its total cost set to zero and gets added to the open list. From this point the goal node is treated like a normal node.</em></li>
  <li><em>The current node is made equal to the node at the beginning of the open list and gets removed from the list.</em></li>
  <li><em>All of the current node’s neighbors get their total cost set to the current node’s cost plus their cost read from the cost field. They then get added to the back of the open list. This happens if and only if the new calculated cost is lower than the old cost. If the neighbor is impassable, then it gets ignored completely.</em></li>
  <li><em>This algorithm continues until the open list is empty.</em></li>
</ul>

<p>This gives higher cost tiles a higher integration number and gives a realistic cost of travel from a certain distance to the goal. From this integration field, the flow field is created. Each tile is given a direction of travel, and for this project was restricted to the 8 cardinal directions. This direction is found by looking at each tiles’ neighbors and finding the lowest cost amongst its neighbors. The direction of travel is towards the lowest cost neighbor.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">FlowFieldPathfinder</span><span class="o">::</span><span class="n">calculateFlowField</span><span class="p">()</span>
<span class="p">{</span>
	<span class="cm">/*go through each cell and compare value to all of its
		neighbors to find the one with the lowest value.*/</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">getGridWidth</span><span class="p">()</span> <span class="o">*</span> <span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">getGridHeight</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">//Get the neighbors of the current node
</span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="n">pNeighbors</span> <span class="o">=</span> <span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">getAdjacentIndices</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">neighborCount</span> <span class="o">=</span> <span class="n">pNeighbors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

		<span class="c1">//find lowest neighbor
</span>		<span class="kt">int</span> <span class="n">lowestNeighbor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">lowestNeighborValue</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
        	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">neighborCount</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        	<span class="p">{</span>
            		<span class="k">if</span> <span class="p">(</span><span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">getCostAtIndex</span><span class="p">(</span><span class="n">pNeighbors</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">lowestNeighborValue</span><span class="p">)</span>
            		<span class="p">{</span>
                		<span class="n">lowestNeighborValue</span> <span class="o">=</span> <span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">getCostAtIndex</span><span class="p">(</span><span class="n">pNeighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
               		 	<span class="n">lowestNeighbor</span> <span class="o">=</span> <span class="n">pNeighbors</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="c1">//set direction to lowest neighbor
</span>		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">lowestX</span> <span class="o">=</span> <span class="n">lowestNeighbor</span> <span class="o">%</span> <span class="n">mpGrid</span><span class="o">-&gt;</span><span class="n">getGridWidth</span><span class="p">();</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">lowestY</span> <span class="o">=</span> <span class="n">lowestNeighbor</span> <span class="o">/</span> <span class="n">mpGrid</span><span class="o">-&gt;</span><span class="n">getGridWidth</span><span class="p">();</span>

		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">currentX</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">mpGrid</span><span class="o">-&gt;</span><span class="n">getGridWidth</span><span class="p">();</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">currentY</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">mpGrid</span><span class="o">-&gt;</span><span class="n">getGridWidth</span><span class="p">();</span>


		<span class="n">Vector2D</span> <span class="n">direction</span><span class="p">((</span><span class="n">lowestX</span> <span class="o">-</span> <span class="n">currentX</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">lowestY</span> <span class="o">-</span> <span class="n">currentY</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="n">f</span><span class="p">);</span>
		<span class="n">mpIntegrationField</span><span class="o">-&gt;</span><span class="n">setDirectionAtIndex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">direction</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This gives mountains a slope, and discourages travel across them, unless they are thin, or it costs less to go across than go around.</p>

<h3 id="retrospection-and-postmortem">Retrospection and Postmortem</h3>

<p>This project was created this past semester, so I feel a full retrospection wouldn’t be very beneficial. Regardless, I will say that the arrows for the visualization of the flow field are &gt;3000 in count, and that could definitely be optimized, because for now the simulation slows down when the flow field is being visualized.</p>

<p>Flow fields are an interesting form of pathfinding because they are computationally expensive on the front end, but once calculated they can be used by any number of boids. This is good for static maps, or static goals, but if a map or path goal is constantly changing, this will not perform well. As such, games like TBS’s or RTS’s with static maps could be potential candidates for using flow fields to dictate their AI movement.</p>

        
      </section>

      
      <footer class="page__meta">
        
        


      </footer>
      
  <nav class="pagination">
    
      <a href="http://localhost:4000/work/90_shooter-state-machine/" class="pagination--pager" title="Shooter State Machine
">Previous</a>
    
    
      <a href="http://localhost:4000/work/92_flocking/" class="pagination--pager" title="Flocking
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Connect:</strong></li>
    
    
      <li><a href="https://twitter.com/tyskwo"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/tyskwo"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Tyler Wood.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92078969-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>
